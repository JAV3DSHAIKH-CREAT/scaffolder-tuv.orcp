<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TUV Certificate Tracker</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Poppins',sans-serif;
}

body{
    background:#f3f6fb;
    padding:20px;
}

/* HEADER */
.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:40px;
}

.logo-left{ height:100px; }
.logo-right{ height:50px; }

/* SEARCH */
.search-container{
    max-width:700px;
    margin:0 auto 30px auto;
    position:relative;
}

#searchBox{
    width:100%;
    padding:16px 20px;
    border-radius:12px;
    border:1px solid #dcdcdc;
    font-size:16px;
    box-shadow:0 3px 12px rgba(0,0,0,0.08);
}

#searchBox:focus{
    outline:none;
    border-color:#2563eb;
}

.suggestions{
    position:absolute;
    width:100%;
    background:#fff;
    border-radius:10px;
    margin-top:5px;
    box-shadow:0 6px 20px rgba(0,0,0,0.1);
    max-height:300px;
    overflow-y:auto;
    z-index:999;
}

.suggestion-item{
    padding:12px 18px;
    cursor:pointer;
    transition:0.2s;
}

.suggestion-item:hover{
    background:#f1f5f9;
}

.highlight{
    background:yellow;
    font-weight:600;
}

/* CARD */
.card{
    max-width:1100px;
    margin:20px auto;
    background:#fff;
    padding:30px;
    border-radius:18px;
    box-shadow:0 10px 30px rgba(0,0,0,0.08);
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:20px;
}

.field label{
    font-size:13px;
    font-weight:600;
    margin-bottom:6px;
    color:#555;
}

.value{
    background:#f8fafc;
    padding:12px;
    border-radius:10px;
    min-height:45px;
    font-size:14px;
}

/* STATUS COLORS */
.status-valid{ background:#e6f7ec !important; color:#15803d; font-weight:600;}
.status-expired{ background:#fde8e8 !important; color:#b91c1c; font-weight:600;}
.status-warning{ background:#fff4e5 !important; color:#c2410c; font-weight:600;}

.footer{
    margin-top:40px;
    text-align:center;
    font-size:14px;
    color:#666;
}

@media(max-width:600px){
    .logo-left{height:70px;}
    .logo-right{height:40px;}
}
</style>
</head>

<body>

<div class="header">
    <img src="orcp.bmp" class="logo-left">
    <img src="nbtc.bmp" class="logo-right">
</div>

<div class="search-container">
    <input type="text" id="searchBox" placeholder="Search by EMP# or Name...">
    <div class="suggestions" id="suggestions"></div>
</div>

<div id="resultContainer"></div>

<div class="footer">
Created and Managed by Mohammad Javed Shaikh
</div>

<script>

let dataRows = [];

// LOAD EXCEL FROM SAME FOLDER
fetch("for%20web%20TUV.xlsx")
.then(res => res.arrayBuffer())
.then(data => {
    const workbook = XLSX.read(data, {type:"array"});
    const sheet = workbook.Sheets["TUV"];
    dataRows = XLSX.utils.sheet_to_json(sheet);
})
.catch(()=> alert("Excel file not found in same folder."));


const searchBox = document.getElementById("searchBox");
const suggestionsDiv = document.getElementById("suggestions");

searchBox.addEventListener("input", function(){
    const value = this.value.trim().toLowerCase();
    suggestionsDiv.innerHTML="";
    if(!value) return;

    const filtered = dataRows.filter(row =>
        String(row["EMP#"]).toLowerCase().includes(value) ||
        String(row["NAME"]).toLowerCase().includes(value)
    ).slice(0,10);

    filtered.forEach(row=>{
        const div = document.createElement("div");
        div.classList.add("suggestion-item");

        const text = `${row["EMP#"]} - ${row["NAME"]}`;
        const regex = new RegExp(`(${value})`, "gi");
        div.innerHTML = text.replace(regex, `<span class="highlight">$1</span>`);

        div.onclick = ()=>showDetails(row);
        suggestionsDiv.appendChild(div);
    });
});

function showDetails(row){
    suggestionsDiv.innerHTML="";
    searchBox.value = `${row["EMP#"]} - ${row["NAME"]}`;

    const container = document.getElementById("resultContainer");
    container.innerHTML="";

    const card = document.createElement("div");
    card.classList.add("card");

    Object.keys(row).forEach(key=>{
        const field = document.createElement("div");

        const label = document.createElement("label");
        label.textContent = key;

        const value = document.createElement("div");
        value.classList.add("value");

        let cellValue = row[key];

        if(key === "Remaining days"){
            const expiry = new Date(row["EXPIRY DATE"]);
            const today = new Date();
            const diff = Math.ceil((expiry - today)/(1000*60*60*24));
            cellValue = diff;

            if(diff < 0){
                value.classList.add("status-expired");
            } else if(diff < 30){
                value.classList.add("status-warning");
            } else{
                value.classList.add("status-valid");
            }
        }

        if(key === "Status"){
            const expiry = new Date(row["EXPIRY DATE"]);
            const today = new Date();
            const diff = Math.ceil((expiry - today)/(1000*60*60*24));

            if(diff < 0){
                cellValue = "Expired";
                value.classList.add("status-expired");
            } else if(diff < 30){
                cellValue = "Expiring Soon";
                value.classList.add("status-warning");
            } else{
                cellValue = "Valid";
                value.classList.add("status-valid");
            }
        }

        value.textContent = cellValue ?? "-";
        field.appendChild(label);
        field.appendChild(value);
        card.appendChild(field);
    });

    container.appendChild(card);
}

// Hide suggestions when clicking outside
document.addEventListener("click", function(e){
    if(!document.querySelector(".search-container").contains(e.target)){
        suggestionsDiv.innerHTML="";
    }
});

</script>

</body>
</html>

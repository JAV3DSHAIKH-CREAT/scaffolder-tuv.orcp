<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TUV Certificate Tracker</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Poppins',sans-serif;
}

body{
    background:#f4f6fb;
    padding:20px;
}

/* HEADER */
.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:40px;
}

.logo-left{ height:100px; }
.logo-right{ height:50px; }

/* SEARCH */
.search-container{
    max-width:700px;
    margin:0 auto 30px auto;
    position:relative;
}

#searchBox{
    width:100%;
    padding:16px 20px;
    border-radius:12px;
    border:1px solid #ccc;
    font-size:16px;
    box-shadow:0 4px 15px rgba(0,0,0,0.08);
}

#searchBox:focus{
    outline:none;
    border-color:#2563eb;
}

.suggestions{
    position:absolute;
    width:100%;
    background:#fff;
    border-radius:10px;
    box-shadow:0 8px 20px rgba(0,0,0,0.1);
    max-height:300px;
    overflow-y:auto;
    margin-top:5px;
    z-index:999;
}

.suggestion-item{
    padding:12px 18px;
    cursor:pointer;
    transition:0.2s;
}

.suggestion-item:hover{
    background:#eef2ff;
}

.highlight{
    background:yellow;
    font-weight:600;
}

/* DETAILS CARD */
.card{
    max-width:1100px;
    margin:20px auto;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:20px;
}

.box{
    background:#fff;
    padding:18px;
    border-radius:15px;
    box-shadow:0 8px 25px rgba(0,0,0,0.08);
}

.label{
    font-size:13px;
    font-weight:600;
    margin-bottom:6px;
    color:#555;
}

.value{
    font-size:14px;
    word-break:break-word;
}

/* STATUS COLORS */
.status-valid{
    color:#15803d;
    font-weight:600;
}

.status-expired{
    color:#b91c1c;
    font-weight:600;
}

.status-warning{
    color:#d97706;
    font-weight:600;
}

/* FOOTER */
.footer{
    text-align:center;
    margin-top:40px;
    color:#666;
}

@media(max-width:600px){
    .logo-left{height:70px;}
    .logo-right{height:40px;}
}
</style>
</head>

<body>

<div class="header">
    <img src="orcp.bmp" class="logo-left">
    <img src="nbtc.bmp" class="logo-right">
</div>

<div class="search-container">
    <input type="text" id="searchBox" placeholder="Search by EMP# or Name...">
    <div class="suggestions" id="suggestions"></div>
</div>

<div id="detailsContainer" class="card"></div>

<div class="footer">
Created and Managed by Mohammad Javed Shaikh
</div>

<script>

let headers = [];
let rows = [];

// LOAD EXCEL FROM SAME FOLDER
fetch("for%20web%20TUV.xlsx")
.then(res => res.arrayBuffer())
.then(data => {
    const workbook = XLSX.read(data,{type:"array"});
    const sheet = workbook.Sheets["TUV"];
    const json = XLSX.utils.sheet_to_json(sheet,{header:1});

    headers = json[0];      // First row = headers
    rows = json.slice(1);   // Remaining rows
})
.catch(()=>alert("Excel file not loading. Use Live Server or GitHub Pages."));

const searchBox = document.getElementById("searchBox");
const suggestions = document.getElementById("suggestions");
const detailsContainer = document.getElementById("detailsContainer");

// SEARCH FUNCTION
searchBox.addEventListener("input",function(){

    const value = this.value.trim().toLowerCase();
    suggestions.innerHTML="";
    if(!value) return;

    rows.forEach((row,index)=>{

        const colA = String(row[0] || "");
        const colB = String(row[1] || "");

        if(colA.toLowerCase().includes(value) || colB.toLowerCase().includes(value)){

            const div = document.createElement("div");
            div.className="suggestion-item";

            const displayText = colA + " - " + colB;
            const regex = new RegExp(value,"gi");

            div.innerHTML = displayText.replace(regex,match=>`<span class="highlight">${match}</span>`);

            div.onclick = ()=>showDetails(index);

            suggestions.appendChild(div);
        }

    });

});

// SHOW DETAILS
function showDetails(index){

    suggestions.innerHTML="";
    const row = rows[index];
    detailsContainer.innerHTML="";

    headers.forEach((header,i)=>{

        const box = document.createElement("div");
        box.className="box";

        const label = document.createElement("div");
        label.className="label";
        label.textContent = header;

        const value = document.createElement("div");
        value.className="value";

        let cell = row[i] || "-";

        // AUTO CALCULATE REMAINING DAYS
        if(header.toLowerCase().includes("remaining")){
            const expiryIndex = headers.findIndex(h=>h.toLowerCase().includes("expiry"));
            if(expiryIndex !== -1){
                const expiry = new Date(row[expiryIndex]);
                const today = new Date();
                const diff = Math.ceil((expiry - today)/(1000*60*60*24));
                cell = diff;
            }
        }

        // STATUS COLOR BASED ON EXPIRY
        if(header.toLowerCase().includes("status")){
            const expiryIndex = headers.findIndex(h=>h.toLowerCase().includes("expiry"));
            if(expiryIndex !== -1){
                const expiry = new Date(row[expiryIndex]);
                const today = new Date();
                const diff = Math.ceil((expiry - today)/(1000*60*60*24));

                if(diff < 0){
                    value.classList.add("status-expired");
                    cell = "Expired";
                }
                else if(diff < 30){
                    value.classList.add("status-warning");
                    cell = "Expiring Soon";
                }
                else{
                    value.classList.add("status-valid");
                    cell = "Valid";
                }
            }
        }

        value.textContent = cell;

        box.appendChild(label);
        box.appendChild(value);
        detailsContainer.appendChild(box);

    });

}

// CLOSE SUGGESTION WHEN CLICK OUTSIDE
document.addEventListener("click",function(e){
    if(!document.querySelector(".search-container").contains(e.target)){
        suggestions.innerHTML="";
    }
});

</script>

</body>
</html>
